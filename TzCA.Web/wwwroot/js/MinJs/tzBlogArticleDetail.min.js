function tzBlogArticleForm(){layui.use(["form","layedit","laydate"],function(){function l(){var n=$(".commentDateTime");n!==undefined&&$.each(n,function(n,t){$(t).find("span").html(tzBlog.renderBlogArticleTimeAgo($(t).data("commentdtime")))})}function u(){tzEmoji.parse({iconPath:"lib/",source:".commentDetailContent p"});tzEmoji.parse({iconPath:"lib/",source:".commentReplyUserDetailInfo .commentReplyContent"})}function a(){var n=$(".commentReplyItemTime");n!==undefined&&$.each(n,function(n,t){$(t).find("span").html(tzBlog.renderBlogArticleTimeAgo($(t).data("commentreplydtime")))})}function v(){var n=$(".tzCloudAllianceQuotations ul"),i,u,t=0,f="",r="1s",e=4e3;n.html('<li><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"><\/i>加载中...<\/li>');$.ajax({url:"../../TzData/Quotations",type:"get",async:!1,success:function(o){$.each(o,function(n,t){f+='<li style="background:#62bcfa">'+t+"<\/li>"});n.html(f);n.append(n.children().eq(0).clone());i=n.children();u=i.eq(0).height();setInterval(function(){n.css({top:-u*t,transition:"top "+r});t++;r="1s";t>=i.length&&(t=0,r="0s")},e)}})}function e(t,i,r){let u=t,f=r,e='<form class="layui-form layui-form-pane" action="">   <div class="layui-form-item">       <input type="hidden" name="ReceiveRespondentId" value="'+i+'">       <textarea placeholder="@'+f+'：" class="layui-textarea rootCommentReply" name="RootCommentReply"><\/textarea>   <\/div>   <div class="layui-form-item">       <button type="button" class="layui-btn layui-btn-sm tzCommentReplyItemRootSaveBtn" lay-submit="" lay-filter="tzCommentReplyItemSaveBtn"><i class="layui-icon layui-icon-release"><\/i>发表<\/button>       <button type="button" class="layui-btn layui-btn-primary layui-btn-sm tzCommentReplyItemRootCancelBtn">取消<\/button>   <\/div><\/form>';u.parent().parent().siblings().find(".commentReplyItemFormArea").html("");u.children().length===0?(h(),u.html(e),u.find("textarea").focus(),tzEmoji.init({iconPath:"lib/",textarea:".rootCommentReply"}),tzEmoji.reSetForArticleReply()):u.find("textarea").val()!==""?n.confirm("您要放弃当前的回复吗？",{title:"",btn:["确定","取消"]},function(t){u.find("textarea").val("");u.html("");n.close(t)}):u.html("")}function o(t,i,r){let u=t,f=r,e='<form class="layui-form layui-form-pane" action="">   <div class="layui-form-item">       <input type="hidden" name="ReceiveRespondentId" value="'+i+'">       <textarea placeholder="@'+f+'：" class="layui-textarea unRootCommentReply" name="UnRootCommentReply"><\/textarea>   <\/div>   <div class="layui-form-item">       <button type="button" class="layui-btn layui-btn-sm tzCommentReplyItemSaveBtn" lay-submit="" lay-filter="tzCommentReplyItemSaveBtn"><i class="layui-icon layui-icon-release"><\/i>发表<\/button>       <button type="button" class="layui-btn layui-btn-primary layui-btn-sm tzCommentReplyItemCancelBtn" >取消<\/button>   <\/div><\/form>';u.parent().parent().siblings().find(".commentReplyItemFormArea").html("");u.children().length===0?(h(),u.html(e),u.find("textarea").focus(),tzEmoji.init({iconPath:"lib/",textarea:".unRootCommentReply"}),tzEmoji.reSetForArticleReply()):u.find("textarea").val()!==""?n.confirm("您要放弃当前的回复吗？",{title:"",btn:["确定","取消"]},function(t){u.find("textarea").val("");u.html("");n.close(t)}):u.html("")}function y(n){let t={commentId:"",commentUserId:"",commentUserAvatar:"",commentUserNickname:"",commentContent:"",commentDTime:""},i="",r=$(".tzBlogArticleCommentList>ul");t=n;i='<li class="tzBlogArticleCommentItem" data-commentid="'+t.commentId+'"><div class="commentDetailTop">   <img class="commentatorAvatar" src="'+t.commentUserAvatar+'" alt="头像">   <div class="commentatorInfo">       <h4 class="commentNickname"><a href="javascript:">'+t.commentUserNickname+'<\/a>           <i class="iconFont icon-ident" title="认证信息"><\/i>           <i class="blogAuthorLevel layui-badge layui-bg-cyan">VIP<\/i>       <\/h4>       <div class="commentDateTime">           <span>'+tzBlog.renderBlogArticleTimeAgo(t.commentDTime)+'<\/span>       <\/div>        <div class="commentBtns">           <a href="javascript:" class="commentDelete" data-commentreplyid="'+t.commentId+'">删除<\/a>           <a href="javascript:" class="commentReply" data-commentreplyuserid="'+t.commentUserId+'"><i class="iconFont blogCommitIcon"><\/i>回复(<span class="commentReplysCount" id="'+t.commentId+'">0<\/span>)<\/a>       <\/div>   <\/div><\/div>   <div class="commentDetailContent">       <p>'+t.commentContent+'<\/p>       <div class="commentReplyItemFormArea"><\/div>   <\/div>   <ul class="commentReplyList"><\/ul><\/li>';r.append(i);u()}function s(n){let t={replyId:"",replyUserId:"",replySaveBtn:"",replyFillArea:"",replyUserAvatar:"",replyUserNickname:"",userNickname:"",replyContent:"",replyDTime:""},i=null,r="";t=n;i=t.replySaveBtn.parent().parent().parent();r='<li class="commentReplyItem"><img class="commentReplyUserAvatar" src="'+t.replyUserAvatar+'" alt="'+t.replyUserNickname+'"><div class="commentReplyUserDetailInfo">   <a href="javascript:" class="replyBtn">'+t.replyUserNickname+'<\/a>  <span>&nbsp;回复&nbsp;<\/span>  <a href="javascript:" title="'+t.userNickname+'迷你资料卡">'+t.userNickname+'<\/a>   <span>：<\/span>   <span class="commentReplyContent">'+t.replyContent+'<\/span>   <div class="commentReplyItemTime">       <span>'+tzBlog.renderBlogArticleTimeAgo(t.replyDTime)+'<\/span>       <a class="commentReplyItemDeleteBtn" href="javascript:" data-commentreplyid="'+t.replyId+'" title="删除" style="display: none;">删除<\/a>       <a class="commentReplyItemBtn" href="javascript:" data-userid="'+t.replyUserId+'" title="回复" style="display: none;">回复<\/a>   <\/div>   <div class="commentReplyItemFormArea"><\/div><\/div><\/li>';i.html("");i.find("textarea").val("");t.replyFillArea.append(r);u()}function h(){$(".commentReplyItemFormArea").html("")}function i(){$(".backBlogArticleList").off("click").on("click",function(n){n.preventDefault();articleDetailPage.hide()});$(".tzBlogArticleComment,.blogCommitNum").off("click").on("click",function(){$("#tzBlogArticleDetailArea").animate({scrollTop:$(".tzBlogArticleDetailBody").height()+10+120+60+15},500);$("form[name=tzBlogArticleCommentForm]").find("textarea").focus()});$(".commentDetailTop").off("mouseenter").on("mouseenter",function(n){n.preventDefault();let t=$(this).find(".commentDelete");t!==undefined&&t.show();$(this).find(".commentDelete").show()});$(".commentDetailTop").off("mouseleave").on("mouseleave",function(n){n.preventDefault();let t=$(this).find(".commentDelete");t!==undefined&&t.hide();$(this).find(".commentDelete").hide()});$(".commentReplyItem").off("mouseenter").on("mouseenter",function(n){n.preventDefault();let t=$(this).find(".commentReplyItemDeleteBtn");t!==undefined&&t.show();$(this).find(".commentReplyItemBtn").show()});$(".commentReplyItem").off("mouseleave").on("mouseleave",function(n){n.preventDefault();let t=$(this).find(".commentReplyItemDeleteBtn");t!==undefined&&t.hide();$(this).find(".commentReplyItemBtn").hide()});$(".commentReply").off("click").on("click",function(n){n.preventDefault();let t=$(this),r=t.parent().parent().parent().next().find(".commentReplyItemFormArea");return e(r,t.data("commentreplyuserid"),t.parent().parent().find(".commentNickname>a").text()),i(),!1});$(".commentReplyItemBtn").off("click").on("click",function(n){n.preventDefault();let t=$(this);return o(t.parent().next(),t.data("userid"),t.parent().parent().find(".replyBtn").text()),i(),!1});$(".tzBlogArticleCommentBtn").off("click").on("click",function(u){u.preventDefault();let f=$(this),o=$("#tzBlogArticleDetailArea").data("articleid"),e=$("form[name=tzBlogArticleCommentForm]").find("textarea");if(e.val()===""){n.tips("请说点什么吧",f,{id:"tzBlogArticleCommentBtnTips",tips:4});e.focus();return}f.html(r);var s=tzVerify.modalInit({btn:f,func:function(){$.ajax({url:"../../Blog/Comment",type:"post",data:{articleId:o,content:filterXSS(e.val())},success:function(r){if(r.state&&r.code===200){y({commentId:r.data.id,commentUserId:r.data.commentUser.id,commentUserAvatar:r.data.commentUser.avatar,commentUserNickname:r.data.commentUser.nickname,commentContent:r.data.content,commentDTime:r.data.createTime});e.val("");$("#tzBlogArticleDetailArea").animate({scrollTop:98+($(".tzBlogArticleDetailBody").height()+10)+120+60+$(".tzBlogArticleDetailFoot").height()},500);f.html(t);c();n.close(tzVerify.modalIndex);toastr.success("发布评论成功！");notification.send({objectId:o,content:r.data.content,contentSource:$(".tzBlogArticleDetailHead>h2>a").text(),receiverId:r.data.commentReplyUser.id,source:"文章评论"});$(".tzBlogArticleCommentItemNull").hide();i();return}f.html(t);n.close(tzVerify.modalIndex);n.msg(r.msg)},error:function(i){f.html(t);n.close(tzVerify.modalIndex);tzAjaxStatus(i.status)}})}})});$(".tzCommentReplyItemRootSaveBtn").off("click").on("click",function(u){u.preventDefault();let e=$(this),o=e.parent().parent().parent().parent().parent().data("commentid"),c=e.parent().prev().find("input[name=ReceiveRespondentId]").val(),h=e.parent().prev().find("textarea"),l=e.parent().parent().parent().parent().parent().find(".commentDetailContent>p").text();if(h.val()===""){n.tips("请说点什么吧",e,{id:"tzCommentReplyItemRootSaveBtnTips",tips:4});h.focus();return}e.html(r);var a=tzVerify.modalInit({btn:e,func:function(){$.ajax({url:"../../Blog/Reply",type:"post",data:{commentId:o,commentReplyUserId:c,content:filterXSS(h.val())},success:function(r){if(r.state&&r.code===200){s({replyId:r.data.id,replyUserId:r.data.commentReplyUser.id,replySaveBtn:e,replyFillArea:e.parent().parent().parent().parent().next(),replyUserAvatar:r.data.commentReplyUser.avatar,replyUserNickname:r.data.commentReplyUser.nickname,userNickname:r.data.commentUser.nickname,replyContent:r.data.content,replyDTime:r.data.createTime});e.html(t);f(o);n.close(tzVerify.modalIndex);toastr.success("回复成功！");notification.send({objectId:o,content:r.data.content,contentSource:l,receiverId:c,source:"评论回复"});i();return}e.html(t);n.close(tzVerify.modalIndex);n.msg(r.msg)},error:function(i){e.html(t);n.close(tzVerify.modalIndex);tzAjaxStatus(i.status)}})}});return!1});$(".tzCommentReplyItemSaveBtn").off("click").on("click",function(u){u.preventDefault();let e=$(this),h=e.parent().parent().parent().parent().parent().parent().parent().data("commentid"),c=e.parent().prev().find("input[name=ReceiveRespondentId]").val(),o=e.parent().prev().find("textarea"),l=e.parent().parent().parent().parent().find(".commentReplyContent").text(),a=e.parent().parent().parent().parent().parent().data("id");if(o.val()===""){n.tips("请说点什么吧",e,{id:"tzCommentReplyItemSaveBtnTips",tips:4});o.focus();return}e.html(r);var v=tzVerify.modalInit({btn:e,func:function(){$.ajax({url:"../../Blog/Reply",type:"post",data:{commentId:h,commentReplyUserId:c,content:filterXSS(o.val())},success:function(r){if(r.state&&r.code===200){s({replyId:r.data.id,replyUserId:r.data.commentReplyUser.id,replySaveBtn:e,replyFillArea:e.parent().parent().parent().parent().parent().parent(),replyUserAvatar:r.data.commentReplyUser.avatar,replyUserNickname:r.data.commentReplyUser.nickname,userNickname:r.data.commentUser.nickname,replyContent:r.data.content,replyDTime:r.data.createTime});e.html(t);f(h);n.close(tzVerify.modalIndex);toastr.success("回复成功！");notification.send({objectId:a,content:r.data.content,contentSource:l,receiverId:c,source:"用户回复"});i();return}e.html(t);n.close(tzVerify.modalIndex);n.msg(r.msg)},error:function(i){e.html(t);n.close(tzVerify.modalIndex);tzAjaxStatus(i.status)}})}});return!1});$(".tzCommentReplyItemRootCancelBtn").off("click").on("click",function(n){return n.preventDefault(),e($(this).parent().parent().parent().parent().find(".commentReplyItemFormArea")),!1});$(".tzCommentReplyItemCancelBtn").off("click").on("click",function(n){return n.preventDefault(),o($(this).parent().parent().parent()),!1});$(".commentDelete").off("click").on("click",function(t){t.preventDefault();let i=$(this);n.confirm("您确定删除该评论吗？",{title:"删除确认",btnAlign:"c",btn:["确定","取消"]},function(){var t=top.layer.msg("删除中，请稍候",{icon:16,time:!1,shade:.8});$.ajax({url:"../../Blog/DeleteComment",type:"post",data:{id:i.data("commentreplyid")},success:function(t){if(t.state){c();i.parent().parent().parent().parent().remove();n.msg(t.message);return}n.msg(t.message)},error:function(n){tzAjaxStatus(n.status)}})})});$(".commentReplyItemDeleteBtn").off("click").on("click",function(t){t.preventDefault();let i=$(this);_commentId=i.parent().parent().parent().parent().parent().data("commentid");_commentReplyId=i.data("commentreplyid");n.confirm("您确定删除该回复吗？",{title:"删除确认",btnAlign:"c",btn:["确定","取消"]},function(){var t=top.layer.msg("删除中，请稍候",{icon:16,time:!1,shade:.8});$.ajax({url:"../../Blog/DeleteReply",type:"post",data:{id:_commentReplyId},success:function(t){if(t.state){f(_commentId);i.parent().parent().parent().remove();n.msg(t.message);return}n.msg(t.message)},error:function(n){tzAjaxStatus(n.status)}})})});$(".tzBlogArticlePraiseUp").off("click").on("click",function(){let t=$(this),r=$(".articlePraiseUpCount"),u=$(".articlePraiseDownCount"),i=$("#tzBlogArticleDetailArea").data("articleid");$.ajax({url:"../../Blog/ArticlePraiseUp",type:"post",data:{articleId:i},success:function(f){if(f.state){$.tipsBox({obj:t,str:"+1",callback:function(){}});niceIn(t);r.text(f.data.up);u.text(f.data.down);notification.send({objectId:i,content:null,contentSource:t.parent().parent().parent().find("h2>a").text(),receiverId:tzDefaultDatas.guid(),source:"文章点赞"});n.msg(f.msg);return}n.msg(f.msg)},error:function(n){tzAjaxStatus(n.status)}})});$(".tzBlogArticlePraiseDown").off("click").on("click",function(){let t=$(this),r=$(".articlePraiseUpCount"),u=$(".articlePraiseDownCount"),i=$("#tzBlogArticleDetailArea").data("articleid");$.ajax({url:"../../Blog/ArticlePraiseDown",type:"post",data:{articleId:i},success:function(f){if(f.state){$.tipsBox({obj:t,str:"-1",callback:function(){}});niceIn(t);r.text(f.data.up);u.text(f.data.down);notification.send({objectId:i,content:null,contentSource:t.parent().parent().parent().find("h2>a").text(),receiverId:tzDefaultDatas.guid(),source:"文章被踩"});n.msg(f.msg);return}n.msg(f.msg)},error:function(n){tzAjaxStatus(n.status)}})})}function c(){$.get("../../Blog/GetCommentCount",{articleId:$("#tzBlogArticleDetailArea").data("articleid")},function(n){n===0&&$(".tzBlogArticleCommentItemNull").show();$(".blogCommitCount").text(n)})}function f(n){$.get("../../Blog/GetReplyCount",{commentId:n},function(t){$("#"+n).text(t)})}var p=layui.form,n=layui.layer,w=layui.layedit,b=layui.laydate,r,t;n.tips("记得点个赞哦^_^",".tzBlogArticlePraise",{tips:4});r='<i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"><\/i>发布中...';t='<i class="layui-icon layui-icon-release"><\/i>发布';u();$(".blogDTime").html(tzBlog.renderBlogArticleTimeAgo($(".blogDTime").data("articledtime")));l();a();tzEmoji.init({iconPath:"lib/",textarea:"#articleCommentText"});v();i()})}