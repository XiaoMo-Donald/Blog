function selectImg(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){var t=n.target.result;$("#tailoringImg").cropper("replace",t,!1)};t.readAsDataURL(n.files[0])}}function closeTailor(){$(".tailoring-container").toggle()}function uploadAvatar(n){var t=n;$.ajax({url:"../../Account/SaveChangeAvatar",type:"post",data:t,contentType:!1,processData:!1,beforeSend:function(){$("#sureCut").hide();$("#sureCuting").show()},success:function(n){n.state&&($(".avatar").attr("src",n.url),$("#sureCut").show(),$("#sureCuting").hide(),layer.msg(n.message),closeTailor())},error:function(){$("#sureCut").show();$("#sureCuting").hide()}})}function convertBase64UrlToBlob(n){for(var i=window.atob(n.split(",")[1]),r=new ArrayBuffer(i.length),u=new Uint8Array(r),t=0;t<i.length;t++)u[t]=i.charCodeAt(t);return new Blob([r],{type:"image/png"})}(window.onresize=function(){var n=$(window).height(),t=$(window).width();t<=768?$(".tailoring-content").css({top:(n-$(".tailoring-content").outerHeight())/2,left:0}):$(".tailoring-content").css({top:(n-$(".tailoring-content").outerHeight())/2,left:(t-$(".tailoring-content").outerWidth())/2})})();$(document).on("click","#editAvatar,.editAvatarBtn",function(){$(".tailoring-container").toggle()});$("#tailoringImg").cropper({aspectRatio:1,preview:".previewImg",guides:!1,autoCropArea:.5,dragCrop:!0,movable:!0,resizable:!0,zoomable:!1,mouseWheelZoom:!1,touchDragZoom:!0,rotatable:!0,crop:function(){}});$(".cropper-rotate-btn").on("click",function(){$("#tailoringImg").cropper("rotate",45)});$(".cropper-reset-btn").on("click",function(){$("#tailoringImg").cropper("reset")});var flagX=!0;$(".cropper-scaleX-btn").on("click",function(){flagX?($("#tailoringImg").cropper("scaleX",-1),flagX=!1):($("#tailoringImg").cropper("scaleX",1),flagX=!0);flagX!==flagX});$("#sureCut").on("click",function(){var n,t;if($("#tailoringImg").attr("src")===null)return!1;if(n=$("#tailoringImg").cropper("getCroppedCanvas"),n===null){layer.msg("请选择一张图片");return}t=n.toDataURL("image/png");$("#finalImg").prop("src",t);var r=convertBase64UrlToBlob(t),i=new FormData,u=(new Date).getTime()+".png";i.append("file",r,u);uploadAvatar(i)});$(document).on("click",".tzUserAvatars li",function(){$(this).addClass("selectedAvatar").siblings().removeClass("selectedAvatar")});$(document).on("click",".systemAvatarBtn",function(){if(!($(".systemAvatars").children().length>0)){var n=$(this);_avatarHtml='<div class="tzModel" id="tzModel"><div class="tzModelBody"><form name="AvatarForm"><ul class="tzUserAvatars">';_eleId=null;$.ajax({url:"../../TzData/DefaultAvatars",async:!1,type:"get",success:function(n){$.each(n,function(n,t){_eleId="AvatarSrc"+n.toString();_avatarHtml+='<li><label for="'+_eleId+'"><img class="lazyload" width="100" height="100"  data-original= "'+t+'" ><\/label><input type="radio" class="avatarSrc" id="'+_eleId+'" name="AvatarSrc" value="'+t+'"/><\/li>'});_avatarHtml+='<\/ul><\/form><\/div><div class="tzModelFoot"> <button class="l-btn layui-btn-normal tzModelSaving" disabled="disabled"> <i class="loginLoading layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"><\/i>保存中...<\/button> <button class="l-btn layui-btn-normal tzModelSave"> 保存 <\/button> <button class="tzModelCancel"> 取消 <\/button><\/div><\/div>';$(".systemAvatars").html(_avatarHtml);$("img.lazyload").lazyload({placeholder:"../../images/tzLoading/tz_loading_005.gif"})}})}});$(document).on("click",".tzModelSave",function(){var n=$(this),i=$("form[name=AvatarForm]"),t=i.find("input[type=radio]:checked").val();$.ajax({type:"post",url:"../../Account/SaveChangeUserAvatar",data:{src:t},beforeSend:function(){n.hide();$(".tzModelSaving").show()},success:function(i){i.state?($(".avatar").attr("src",t),$(".tzModelSaving").hide(),n.show(),layer.msg(i.message),closeTailor()):($(".tzModelSaving").hide(),n.show(),layer.msg(i.message,function(){}))},error:function(){$(".tzModelSaving").hide();n.show()}})});$(document).on("click",".tzModelCancel",function(){closeTailor()});