(function(n,t,i){var f=function(t,i){this.$element=t;this.defaults={type:1,figure:100,arith:0,width:"200px",height:"60px",fontSize:"30px",codeLength:6,btnId:"check-btn",ready:function(){},success:function(){},error:function(){}};this.options=n.extend({},this.defaults,i)},e=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s=["#fffff0","#f0ffff","#f0fff0","#fff0f0"],o=["#FF0033","#006699","#993366","#FF9900","#66CC66","#FF33CC"],r,u;f.prototype={init:function(){var n=this;this.loadDom();this.setCode();this.options.ready();this.$element[0].onselectstart=i.body.ondrag=function(){return!1};this.$element.find(".verify-code, .verify-change-code").on("click",function(){n.setCode()});this.htmlDoms.code_btn.on("click",function(){n.checkCode()})},loadDom:function(){this.$element.append('<div class="cerify-code-panel"><div class="verify-code"><\/div><div class="verify-code-area"><div class="verify-input-area"><input type="text" class="varify-input-code" /><\/div><div class="verify-change-area"><a class="verify-change-code">换一张<\/a><\/div><\/div><\/div>');this.isEnd=!1;this.htmlDoms={code_btn:n("#"+this.options.btnId),code:this.$element.find(".verify-code"),code_area:this.$element.find(".verify-code-area"),code_input:this.$element.find(".varify-input-code")};this.htmlDoms.code.css({width:this.options.width,height:this.options.height,"line-height":this.options.height,"font-size":this.options.fontSize});this.htmlDoms.code_area.css({width:this.options.width})},setCode:function(){var h,c,i,u,r,f,n,t,l,a;if(this.isEnd==!1){if(h=Math.floor(Math.random()*3),c=Math.floor(Math.random()*5),this.htmlDoms.code.css({"background-color":s[h],color:o[c]}),this.htmlDoms.code_input.val(""),i="",this.code_chose="",this.options.type==1)for(u=0;u<this.options.codeLength;u++)r=Math.floor(Math.random()*52),f=r%2==0?"font-style:italic;margin-right: 10px;":"font-weight:bolder;",f+=Math.floor(Math.random()*2)==1?"font-weight:bolder;":"",this.code_chose+=e[r],i+='<font style="'+f+'">'+e[r]+"<\/font>";else{n=Math.floor(Math.random()*this.options.figure);t=Math.floor(Math.random()*this.options.figure);this.options.arith==0&&(l=Math.floor(Math.random()*3));switch(l){case 1:this.code_chose=parseInt(n)+parseInt(t);i=n+" + "+t+" = ?";break;case 2:parseInt(n)<parseInt(t)&&(a=n,n=t,t=a);this.code_chose=parseInt(n)-parseInt(t);i=n+" - "+t+" = ?";break;default:this.code_chose=parseInt(n)*parseInt(t);i=n+" × "+t+" = ?"}}this.htmlDoms.code.html(i)}},checkCode:function(){var n;this.options.type==1?(n=this.htmlDoms.code_input.val().toUpperCase(),this.code_chose=this.code_chose.toUpperCase()):n=this.htmlDoms.code_input.val();n==this.code_chose?(this.isEnd=!0,this.options.success(this)):(this.options.error(this),this.setCode())},refresh:function(){this.isEnd=!1;this.$element.find(".verify-code").click()}};r=function(t,i){this.$element=t;this.defaults={type:1,mode:"fixed",vOffset:5,vSpace:5,explain:"向右滑动完成验证",imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},blockSize:{width:"50px",height:"50px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}};this.options=n.extend({},this.defaults,i)};r.prototype={init:function(){var n=this;if(this.loadDom(),this.options.ready(),this.$element[0].onselectstart=i.body.ondrag=function(){return!1},this.options.mode=="pop"){this.$element.on("mouseover",function(){n.showImg()});this.$element.on("mouseout",function(){n.hideImg()});this.htmlDoms.out_panel.on("mouseover",function(){n.showImg()});this.htmlDoms.out_panel.on("mouseout",function(){n.hideImg()})}this.htmlDoms.move_block.on("touchstart",function(t){n.start(t)});this.htmlDoms.move_block.on("mousedown",function(t){n.start(t)});t.addEventListener("touchmove",function(t){n.move(t)});t.addEventListener("mousemove",function(t){n.move(t)});t.addEventListener("touchend",function(){n.end()});t.addEventListener("mouseup",function(){n.end()});n.$element.find(".verify-refresh").on("click",function(){n.refresh()})},loadDom:function(){this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var n="",t="";this.options.type!=1&&(n+='<div class="verify-img-out"><div class="verify-img-panel"><div  class="verify-refresh"><i class="iconfont icon-refresh"><\/i><\/div><div class="verify-gap"><\/div><\/div><\/div>',t='<div  class="verify-sub-block"><\/div>');n+='<div class="verify-bar-area"><span  class="verify-msg">'+this.options.explain+'<\/span><div class="verify-left-bar"><span  class="verify-msg"><\/span><div  class="verify-move-block"><i  class="verify-icon iconfont icon-right"><\/i>'+t+"<\/div><\/div><\/div>";this.$element.append(n);this.htmlDoms={gap:this.$element.find(".verify-gap"),sub_block:this.$element.find(".verify-sub-block"),out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),move_block:this.$element.find(".verify-move-block"),left_bar:this.$element.find(".verify-left-bar"),msg:this.$element.find(".verify-msg"),icon:this.$element.find(".verify-icon"),refresh:this.$element.find(".verify-refresh")};this.status=!1;this.isEnd=!1;this.setSize=this.resetSize(this);this.$element.css("position","relative");this.options.mode=="pop"?(this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}),this.htmlDoms.sub_block.css({display:"none"})):this.htmlDoms.out_panel.css({position:"relative"});this.htmlDoms.gap.css({width:this.options.blockSize.width,height:this.options.blockSize.height});this.htmlDoms.sub_block.css({width:this.options.blockSize.width,height:this.options.blockSize.height});this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px");this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height});this.htmlDoms.bar_area.css({width:this.setSize.bar_width,height:this.options.barSize.height,"line-height":this.options.barSize.height});this.htmlDoms.move_block.css({width:this.options.barSize.height,height:this.options.barSize.height});this.htmlDoms.left_bar.css({width:this.options.barSize.height,height:this.options.barSize.height});this.randSet()},start:function(n){this.isEnd==!1&&(this.htmlDoms.msg.text(""),this.htmlDoms.move_block.css("background-color","#337ab7"),this.htmlDoms.left_bar.css("border-color","#337AB7"),this.htmlDoms.icon.css("color","#fff"),n.stopPropagation(),this.status=!0)},move:function(n){var i,u,t;this.status&&this.isEnd==!1&&(this.options.mode=="pop"&&this.showImg(),i=n.touches?n.touches[0].pageX:n.clientX,u=r.prototype.getLeft(this.htmlDoms.bar_area[0]),t=i-u,this.options.type!=1?t>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2&&(t=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2):t>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3?(this.$element.find(".verify-msg:eq(1)").text("松开验证"),t=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3):this.$element.find(".verify-msg:eq(1)").text(""),t<=0&&(t=parseInt(parseInt(this.options.blockSize.width)/2)),this.htmlDoms.move_block.css("left",t-parseInt(parseInt(this.options.blockSize.width)/2)+"px"),this.htmlDoms.left_bar.css("width",t-parseInt(parseInt(this.options.blockSize.width)/2)+"px"))},end:function(){var n=this,t;this.status&&this.isEnd==!1&&(this.options.type!=1?(t=parseInt(this.options.vOffset),parseInt(this.htmlDoms.gap.css("left"))>=parseInt(this.htmlDoms.move_block.css("left"))-t&&parseInt(this.htmlDoms.gap.css("left"))<=parseInt(this.htmlDoms.move_block.css("left"))+t?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({"border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.isEnd=!0,this.options.success(this)):(this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),setTimeout(function(){n.refresh()},400),this.options.error(this))):parseInt(this.htmlDoms.move_block.css("left"))>=parseInt(this.setSize.bar_width)-parseInt(this.options.barSize.height)-parseInt(this.options.vOffset)?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({color:"#4cae4c","border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.$element.find(".verify-msg:eq(1)").text("验证成功"),this.isEnd=!0,this.options.success(this)):(this.$element.find(".verify-msg:eq(1)").text(""),this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),this.isEnd=!0,setTimeout(function(){n.$element.find(".verify-msg:eq(1)").text("");n.refresh();n.isEnd=!1},400),this.options.error(this)),this.status=!1)},showImg:function(){this.htmlDoms.out_panel.css({display:"block"});this.htmlDoms.sub_block.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"});this.htmlDoms.sub_block.css({display:"none"})},resetSize:function(i){var r,u,f,e,o=i.$element.parent().width()||n(t).width(),s=i.$element.parent().height()||n(t).height();return r=i.options.imgSize.width.indexOf("%")!=-1?parseInt(i.options.imgSize.width)/100*o+"px":i.options.imgSize.width,u=i.options.imgSize.height.indexOf("%")!=-1?parseInt(i.options.imgSize.height)/100*s+"px":i.options.imgSize.height,f=i.options.barSize.width.indexOf("%")!=-1?parseInt(i.options.barSize.width)/100*o+"px":i.options.barSize.width,e=i.options.barSize.height.indexOf("%")!=-1?parseInt(i.options.barSize.height)/100*s+"px":i.options.barSize.height,{img_width:r,img_height:u,bar_width:f,bar_height:e}},randSet:function(){var i=Math.floor(Math.random()*9+1),r=Math.floor(Math.random()*9+1),n=i*parseInt(this.setSize.img_height)/15+parseInt(this.setSize.img_height)*.1,t=r*parseInt(this.setSize.img_width)/15+parseInt(this.setSize.img_width)*.1;this.$element.find(".verify-gap").css({top:n,left:t});this.$element.find(".verify-sub-block").css({top:"-"+(parseInt(this.setSize.img_height)-n+this.options.vSpace)+"px","background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height,"background-position-y":"-"+n+"px","background-position-x":"-"+t+"px"})},refresh:function(){this.htmlDoms.refresh.show();this.$element.find(".verify-msg:eq(1)").text("");this.$element.find(".verify-msg:eq(1)").css("color","#000");this.htmlDoms.move_block.animate({left:"0px"},"fast");this.htmlDoms.left_bar.animate({width:"40px"},"fast");this.htmlDoms.left_bar.css({"border-color":"#ddd"});this.htmlDoms.move_block.css("background-color","#fff");this.htmlDoms.icon.css("color","#000");this.htmlDoms.icon.removeClass("icon-close");this.htmlDoms.icon.addClass("icon-right");this.$element.find(".verify-msg:eq(0)").text(this.options.explain);this.randSet();this.img_rand=Math.floor(Math.random()*this.options.imgName.length);this.$element.find(".verify-img-panel").css({background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height});this.$element.find(".verify-sub-block").css({"background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height});this.isEnd=!1},getLeft:function(t){return n(t).offset().left}};u=function(t,i){this.$element=t;this.defaults={mode:"fixed",defaultNum:4,checkNum:3,vSpace:5,imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}};this.options=n.extend({},this.defaults,i)};u.prototype={init:function(){var n=this;if(n.loadDom(),n.refresh(),n.options.ready(),this.$element[0].onselectstart=i.body.ondrag=function(){return!1},this.options.mode=="pop"){this.$element.on("mouseover",function(){n.showImg()});this.$element.on("mouseout",function(){n.hideImg()});this.htmlDoms.out_panel.on("mouseover",function(){n.showImg()});this.htmlDoms.out_panel.on("mouseout",function(){n.hideImg()})}n.$element.find(".verify-img-panel canvas").on("click",function(t){n.checkPosArr.push(n.getMousePos(this,t));n.num==n.options.checkNum&&(n.num=n.createPoint(n.getMousePos(this,t)),setTimeout(function(){var t=n.comparePos(n.fontPos,n.checkPosArr);t==!1?(n.options.error(n),n.$element.find(".verify-bar-area").css({color:"#d9534f","border-color":"#d9534f"}),n.$element.find(".verify-msg").text("验证失败"),setTimeout(function(){n.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"});n.refresh()},400)):(n.$element.find(".verify-bar-area").css({color:"#4cae4c","border-color":"#5cb85c"}),n.$element.find(".verify-msg").text("验证成功"),n.$element.find(".verify-refresh").hide(),n.$element.find(".verify-img-panel").unbind("click"),n.options.success(n))},400));n.num<n.options.checkNum&&(n.num=n.createPoint(n.getMousePos(this,t)))});n.$element.find(".verify-refresh").on("click",function(){n.refresh()})},loadDom:function(){this.fontPos=[];this.checkPosArr=[];this.num=1;this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var n="";this.setSize=r.prototype.resetSize(this);n+='<div class="verify-img-out"><div class="verify-img-panel"><div class="verify-refresh" style="z-index:3"><i class="iconfont icon-refresh"><\/i><\/div><canvas width="'+this.setSize.img_width+'" height="'+this.setSize.img_height+'"><\/canvas><\/div><\/div><div class="verify-bar-area"><span  class="verify-msg"><\/span><\/div>';this.$element.append(n);this.htmlDoms={out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),msg:this.$element.find(".verify-msg")};this.$element.css("position","relative");this.options.mode=="pop"?this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}):this.htmlDoms.out_panel.css({position:"relative"});this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px");this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,"background-size":this.setSize.img_width+" "+this.setSize.img_height,"margin-bottom":this.options.vSpace+"px"});this.htmlDoms.bar_area.css({width:this.options.barSize.width,height:this.options.barSize.height,"line-height":this.options.barSize.height})},drawImg:function(n,t){var c=this.$element.find("canvas")[0],r=c.getContext("2d"),s,e,i;r.drawImage(t,0,0,parseInt(this.setSize.img_width),parseInt(this.setSize.img_height));var l=["italic small-caps bold 20px microsoft yahei","small-caps normal 25px arial","34px microsoft yahei"],u=[],h=Math.floor(parseInt(this.setSize.img_width)/(parseInt(this.options.defaultNum)+1)),f="",a=Math.floor(Math.random()*5);for(i=1;i<=this.options.defaultNum;i++)u[i-1]=this.getChars("天地玄黄宇宙洪荒日月盈昃辰宿列张寒来暑往秋收冬藏闰余成岁律吕调阳云腾致雨露结为霜金生丽水玉出昆冈剑号巨阙珠称夜光果珍李柰菜重芥姜海咸河淡鳞潜羽翔龙师火帝鸟官人皇始制文字乃服衣裳推位让国有虞陶唐吊民伐罪周发殷汤坐朝问道垂拱平章爱育黎首臣伏戎羌遐迩体率宾归王",u),f=Math.floor(Math.random()*3),r.font=l[f],r.fillStyle=o[a],s=Math.floor(Math.random()*2)==1?Math.floor(parseInt(this.setSize.img_height)/2)+f*20+20:Math.floor(parseInt(this.setSize.img_height)/2)-f*20,r.fillText(u[i-1],h*i,s),this.fontPos[i-1]={char:u[i-1],x:h*i,y:s};for(i=0;i<this.options.defaultNum-this.options.checkNum;i++)this.shuffle(this.fontPos).pop();for(e="",i=0;i<this.fontPos.length;i++)e+=this.fontPos[i].char+",";return this.htmlDoms.msg.text("请顺序点击【"+e.substring(0,e.length-1)+"】"),this.fontPos},getMousePos:function(r,u){var f=u||t.event,s=i.documentElement.scrollLeft||i.body.scrollLeft,h=i.documentElement.scrollTop||i.body.scrollTop,e=f.clientX-(n(r).offset().left-n(t).scrollLeft()),o=f.clientY-(n(r).offset().top-n(t).scrollTop());return{x:e,y:o}},getChars:function(t,i){var r=parseInt(Math.floor(Math.random()*t.length));return r>0&&(r=r-1),tmp_char=t.charAt(r),n.inArray(tmp_char,i)==-1?tmp_char:u.prototype.getChars(t,i)},shuffle:function(n){for(var t=n.length,i,r;t;)i=Math.random()*t-->>>0,r=n[t],n[t]=n[i],n[i]=r;return n},createPoint:function(n){return this.htmlDoms.img_panel.append('<div class="point-area" style="background-color:#1abd6c;color:#fff;z-index:9999;width:30px;height:30px;text-align:center;line-height:30px;border-radius: 50%;position:absolute;top:'+parseInt(n.y-10)+"px;left:"+parseInt(n.x-10)+'px;">'+this.num+"<\/div>"),++this.num},comparePos:function(n,t){for(var r=!0,i=0;i<n.length;i++)if(!(parseInt(t[i].x)+40>n[i].x&&parseInt(t[i].x)-40<n[i].x&&parseInt(t[i].y)+40>n[i].y&&parseInt(t[i].y)-40<n[i].y)){r=!1;break}return r},showImg:function(){this.htmlDoms.out_panel.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"})},refresh:function(){var t=this,i;this.$element.find(".point-area").remove();this.fontPos=[];this.checkPosArr=[];this.num=1;this.img_rand=Math.floor(Math.random()*this.options.imgName.length);i=new Image;i.src=this.options.imgUrl+this.options.imgName[this.img_rand];n(i).on("load",function(){this.fontPos=t.drawImg(t,this)});t.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"});t.$element.find(".verify-msg").text("验证失败");t.$element.find(".verify-refresh").show()}};n.fn.codeVerify=function(n){var t=new f(this,n);t.init()};n.fn.slideVerify=function(n){var t=new r(this,n);t.init()};n.fn.pointsVerify=function(n){var t=new u(this,n);t.init()}})(jQuery,window,document);var tzVerify={modalInit:function(n){let t={ele:"#verifyArea",func:null,defaultNum:4,checkNum:2,imgUrl:"images/",imgNames:["1.jpg","2.jpg"]};t=$.extend(t,n);layui.use(["layer"],function(){let n=layui.layer,i=n.open({type:1,title:"验证码",closeBtn:1,area:["602px","289px"],fixed:!1,content:'<div id="verifyArea"><\/div>'});tzVerify.init(t)})},init:function(n){let t={ele:"",func:null,defaultNum:4,checkNum:2,imgUrl:"images/",imgNames:["1.jpg","2.jpg"]};if(t=$.extend(t,n),t.ele===""){layer.msg("参数配置错误：请设置挂载的元素");return}if(t.imgUrl===""){layer.msg("参数配置错误：请设置背景图片根目录");return}$.each(t.imgNames,function(n,i){i===""&&t.imgNames.splice(n)});t.imgNames.length<=0&&(t.imgNames=["1.jpg","2.jpg"]);$(t.ele).pointsVerify({defaultNum:t.defaultNum,checkNum:t.checkNum,vSpace:5,imgName:t.imgNames,imgSize:{width:"600px",height:"200px"},barSize:{width:"600px",height:"40px"},ready:function(){},success:function(){t.func()},error:function(){layer.msg("验证失败！")}})}};