var tabFilter,menu=[],liIndex,curNav,delMenu,changeRefreshStr=window.sessionStorage.getItem("changeRefresh");layui.define(["element","jquery"],function(n){var i=layui.element,t=layui.$,e,r=function(){this.tabConfig={openTabNum:undefined,tabFilter:"bodyTab",url:undefined}},f,u;r.prototype.navBar=function(n){var i,r,t,u;for(i=typeof n=="string"?JSON.parse(n):n,r="",t=0;t<i.length;t++){if(r+=i[t].spread||i[t].spread==undefined?'<li class="layui-nav-item layui-nav-itemed">':'<li class="layui-nav-item">',i[t].children!=undefined&&i[t].children.length>0){for(r+="<a>",i[t].icon!=undefined&&i[t].icon!=""&&(r+=i[t].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].icon+'" data-icon="'+i[t].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].icon+'">'+i[t].icon+"<\/i>"),r+="<cite>"+i[t].title+"<\/cite>",r+='<span class="layui-nav-more"><\/span>',r+="<\/a>",r+='<dl class="layui-nav-child">',u=0;u<i[t].children.length;u++)r+=i[t].children[u].target=="_blank"?'<dd><a data-url="'+i[t].children[u].href+'" target="'+i[t].children[u].target+'">':'<dd><a data-url="'+i[t].children[u].href+'">',i[t].children[u].icon!=undefined&&i[t].children[u].icon!=""&&(r+=i[t].children[u].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].children[u].icon+'" data-icon="'+i[t].children[u].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].children[u].icon+'">'+i[t].children[u].icon+"<\/i>"),r+="<cite>"+i[t].children[u].title+"<\/cite><\/a><\/dd>";r+="<\/dl>"}else r+=i[t].target=="_blank"?'<a data-url="'+i[t].href+'" target="'+i[t].target+'">':'<a data-url="'+i[t].href+'">',i[t].icon!=undefined&&i[t].icon!=""&&(r+=i[t].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].icon+'" data-icon="'+i[t].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].icon+'">'+i[t].icon+"<\/i>"),r+="<cite>"+i[t].title+"<\/cite><\/a>";r+="<\/li>"}return r};r.prototype.render=function(){var n=this;t(".navBar ul").html('<li class="layui-nav-item layui-this"><a data-url="page/main.html"><i class="layui-icon" data-icon=""><\/i><cite>后台首页<\/cite><\/a><\/li>').append(n.navBar(dataStr)).height(t(window).height()-210);i.init();t(window).resize(function(){t(".navBar").height(t(window).height()-210)})};r.prototype.changeRegresh=function(n){changeRefreshStr=="true"&&t(".clildFrame .layui-tab-item").eq(n).find("iframe")[0].contentWindow.location.reload()};r.prototype.set=function(n){var i=this;return t.extend(!0,i.tabConfig,n),i};r.prototype.getLayId=function(n){return t(".layui-tab-title.top_tab li").each(function(){t(this).find("cite").text()==n&&(e=t(this).attr("lay-id"))}),e};r.prototype.hasTab=function(n){var i=-1;return t(".layui-tab-title.top_tab li").each(function(){t(this).find("cite").text()==n&&(i=1)}),i};f=0;r.prototype.tabAdd=function(n){var r,o,u,e;if(window.sessionStorage.getItem("menu")&&(menu=JSON.parse(window.sessionStorage.getItem("menu"))),r=this,o=r.tabConfig.openTabNum,tabFilter=r.tabConfig.tabFilter,n.attr("target")=="_blank")window.open(n.attr("data-url"));else if(n.attr("data-url")!=undefined)if(u="",n.find("i.seraph,i.layui-icon").attr("data-icon")!=undefined&&(u+=n.find("i.seraph").attr("data-icon")!=undefined?'<i class="seraph '+n.find("i.seraph").attr("data-icon")+'"><\/i>':'<i class="layui-icon">'+n.find("i.layui-icon").attr("data-icon")+"<\/i>"),r.hasTab(n.find("cite").text())==-1&&n.siblings("dl.layui-nav-child").length==0){if(t(".layui-tab-title.top_tab li").length==o){layer.msg("只能同时打开"+o+"个选项卡哦。不然系统会卡的！");return}f++;u+="<cite>"+n.find("cite").text()+"<\/cite>";u+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+f+'">&#x1006;<\/i>';i.tabAdd(tabFilter,{title:u,content:"<iframe src='"+n.attr("data-url")+"' data-id='"+f+"'><\/frame>",id:(new Date).getTime()});e={icon:n.find("i.seraph").attr("data-icon")!=undefined?n.find("i.seraph").attr("data-icon"):n.find("i.layui-icon").attr("data-icon"),title:n.find("cite").text(),href:n.attr("data-url"),layId:(new Date).getTime()};menu.push(e);window.sessionStorage.setItem("menu",JSON.stringify(menu));window.sessionStorage.setItem("curmenu",JSON.stringify(e));i.tabChange(tabFilter,r.getLayId(n.find("cite").text()));r.tabMove()}else e={icon:n.find("i.seraph").attr("data-icon")!=undefined?n.find("i.seraph").attr("data-icon"):n.find("i.layui-icon").attr("data-icon"),title:n.find("cite").text(),href:n.attr("data-url")},r.changeRegresh(n.parent(".layui-nav-item").index()),window.sessionStorage.setItem("curmenu",JSON.stringify(e)),i.tabChange(tabFilter,r.getLayId(n.find("cite").text())),r.tabMove()};r.prototype.tabMove=function(){t(window).on("resize",function(n){var a=t("#top_tabs_box"),u=t("#top_tabs_box").width(),i=t("#top_tabs"),f=t("#top_tabs").width(),o=i.find("li.layui-this"),l=document.getElementById("top_tabs"),n=n||window.event,e,s,h,c,r;if(f>u){o.position().left>u||o.position().left+u>f?i.css("left",u-f):i.css("left",-o.position().left);e=!1;s={x:0,y:0};function down(n){e=!0;var t;t=n.touches?n.touches[0]:n;s.x=t.clientX;c=l.offsetLeft}function move(n){var i=this,t;e&&(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),t=n.touches?n.touches[0]:n,h=t.clientX-s.x,r=c+h,r=r>0?0:r<u-f?u-f:c+h,l.style.left=r+"px",document.addEventListener("touchmove",function(){n.preventDefault()},!1))}function end(){e=!1}i.on("mousedown",down);i.on("mousemove",move);t(document).on("mouseup",end);i.on("touchstart",down);i.on("touchmove",move);i.on("touchend",end)}else return i.off("mousedown",down),i.off("mousemove",move),i.off("mouseup",end),i.off("touchstart",down),i.off("touchmove",move),i.off("touchend",end),i.removeAttr("style"),!1}).resize()};t("body").on("click",".top_tab li",function(){var n="",r=JSON.parse(window.sessionStorage.getItem("menu"));window.sessionStorage.getItem("menu")&&(n=r[t(this).index()-1]);t(this).index()==0?window.sessionStorage.setItem("curmenu",""):(window.sessionStorage.setItem("curmenu",JSON.stringify(n)),window.sessionStorage.getItem("curmenu")=="undefined"&&(curNav!=JSON.stringify(delMenu)?window.sessionStorage.setItem("curmenu",curNav):window.sessionStorage.setItem("curmenu",JSON.stringify(r[liIndex-1]))));i.tabChange(tabFilter,t(this).attr("lay-id")).init();u.changeRegresh(t(this).index());setTimeout(function(){u.tabMove()},100)});t("body").on("click",".top_tab li i.layui-tab-close",function(){var n,r;liIndex=t(this).parent("li").index();n=JSON.parse(window.sessionStorage.getItem("menu"));n!=null&&(delMenu=n[liIndex-1],r=window.sessionStorage.getItem("curmenu")=="undefined"?undefined:window.sessionStorage.getItem("curmenu")==""?"":JSON.parse(window.sessionStorage.getItem("curmenu")),JSON.stringify(r)!=JSON.stringify(n[liIndex-1])?curNav=JSON.stringify(r):t(this).parent("li").length>liIndex?(window.sessionStorage.setItem("curmenu",r),curNav=r):(window.sessionStorage.setItem("curmenu",JSON.stringify(n[liIndex-1])),curNav=JSON.stringify(n[liIndex-1])),n.splice(liIndex-1,1),window.sessionStorage.setItem("menu",JSON.stringify(n)));i.tabDelete("bodyTab",t(this).parent("li").attr("lay-id")).init();u.tabMove()});t(".refresh").on("click",function(){t(this).hasClass("refreshThis")?(t(this).removeClass("refreshThis"),t(".clildFrame .layui-tab-item.layui-show").find("iframe")[0].contentWindow.location.reload(),setTimeout(function(){t(".refresh").addClass("refreshThis")},2e3)):layer.msg("您点击的速度超过了服务器的响应速度，还是等两秒再刷新吧！")});t(".closePageOther").on("click",function(){if(t("#top_tabs li").length>2&&t("#top_tabs li.layui-this cite").text()!="后台首页"){var n=JSON.parse(window.sessionStorage.getItem("menu"));t("#top_tabs li").each(function(){if(t(this).attr("lay-id")!=""&&!t(this).hasClass("layui-this")){i.tabDelete("bodyTab",t(this).attr("lay-id")).init();for(var r=0;r<n.length;r++)t("#top_tabs li.layui-this cite").text()==n[r].title&&(n.splice(0,n.length,n[r]),window.sessionStorage.setItem("menu",JSON.stringify(n)))}})}else t("#top_tabs li.layui-this cite").text()=="后台首页"&&t("#top_tabs li").length>1?t("#top_tabs li").each(function(){t(this).attr("lay-id")==""||t(this).hasClass("layui-this")||(i.tabDelete("bodyTab",t(this).attr("lay-id")).init(),window.sessionStorage.removeItem("menu"),n=[],window.sessionStorage.removeItem("curmenu"))}):layer.msg("没有可以关闭的窗口了@_@");tab.tabMove()});t(".closePageAll").on("click",function(){t("#top_tabs li").length>1?t("#top_tabs li").each(function(){t(this).attr("lay-id")!=""&&(i.tabDelete("bodyTab",t(this).attr("lay-id")).init(),window.sessionStorage.removeItem("menu"),menu=[],window.sessionStorage.removeItem("curmenu"))}):layer.msg("没有可以关闭的窗口了@_@");tab.tabMove()});u=new r;n("bodyTab",function(n){return u.set(n)})});