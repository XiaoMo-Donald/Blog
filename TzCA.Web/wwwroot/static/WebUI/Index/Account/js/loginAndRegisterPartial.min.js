function preventFormDefault(){$("form").on("submit",function(n){n.preventDefault()})}function randomBackground(){var t=$(window).width(),i=$(window).height(),n=random(0,2);$("body").css({"background-image":"url('../static/WebUI/Index/images/"+["bg_01.jpg","bg_02.jpg","bg_03.jpg"][n]+"')","background-size":"100% 100%","background-repeat":"no-repeat"})}function reLoginAndRegisterAreaSize(){var i=$(window).height(),t=$("#loginAndRegisterArea"),n;t.fadeIn();n=(i-100)/2-t.height()/2-80;n=n<10?10:n;t.css("margin-top",n)}function loginInit(){reLoginAndRegisterAreaSize();registerBtnState.listenInputHelper();verificationToken=$("#formAntiForgeryToken").html();$(".loginFormAntiForgeryToken").html(verificationToken)}var verificationToken=null,tzEventsListen;window.onresize=function(){reLoginAndRegisterAreaSize()};setInterval(function(){},1e4);tzEventsListen={goToRegister:function(){$(".goToRegister").on("click",function(n){n.preventDefault();registerArea.go()})},backLogin:function(){$(".backLogin").on("click",function(n){n.preventDefault();registerArea.backLogin()})},all:function(){this.goToRegister();this.backLogin()}};tzEventsListen.all();var loginBtnState={loginStatusBtn:$(".loginStatusBtn"),loginBtn:$(".loginBtn"),loginForm:$("form[name=LoginForm] input"),verificationCode:$(".loginVerificationCode"),goToRegister:$(".goToRegisterTab"),clearData:function(){this.loginForm.val("");verificationCode.onDraw(show_num);listVerificationCodeEvent()},defaultShow:function(){this.loginStatusBtn.hide();this.loginBtn.show();this.loginForm.removeAttr("disabled");this.verificationCode.attr("data-disabled","false");tzEventsListen.goToRegister()},statusShow:function(){this.loginStatusBtn.show();this.loginBtn.hide();this.loginForm.attr("disabled","disabled");this.verificationCode.attr("data-disabled","true");this.goToRegister.off("click")}},registerBtnState={registerStatusBtn:$(".registerStatusBtn"),registerBtn:$(".registerBtn"),registerForm:$("form[name=RegisterForm] input"),verificationCode:$(".registerVerificationCode"),backLogin:$(".backLoginTab"),randomNicknameBtn:$(".randomNickname"),agreeTermsOfUse:!1,clearData:function(){this.registerForm.val("");verificationCode.onDraw(show_num);listVerificationCodeEvent()},defaultShow:function(){this.registerStatusBtn.hide();this.registerBtn.show();this.registerForm.removeAttr("disabled");this.verificationCode.attr("data-disabled","false");tzEventsListen.backLogin();this.randomNicknameBtn.removeAttr("disabled");listVerificationCodeEvent()},statusShow:function(){this.registerStatusBtn.show();this.registerBtn.hide();this.registerForm.attr("disabled","disabled");this.verificationCode.attr("data-disabled","true");this.backLogin.off("click");this.randomNicknameBtn.attr("disabled","disabled")},listenInputHelper:function(){$(".usernameHelper>i").mouseenter(function(){layer.tips("用于登录",".usernameHelper",{id:"Tz_usernameHelperTips"});$(this).css("color","#333")}).mouseleave(function(){$(this).css("color","#777")});$(".passwordHelper>i").mouseenter(function(){layer.tips("密码强度",".passwordHelper",{id:"Tz_passwordHelperTips"});layer.msg("密码说明<br/>长度最少6位，且包含数字、字母 如：demo123",{time:1e4,btnAlign:"c",id:"Tz_passwordHelper",btn:["确定"]});$(this).css("color","#333")}).mouseleave(function(){$(this).css("color","#777")})}},termsOfUseTpl={content:'<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">1.使用条款xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br><br>2.使用条款xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br><br>3.使用条款xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br><br>4.使用条款xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br><br>5.使用条款xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<\/div>'},registerArea={allArea:$(".loginAndRegisterArea"),loginArea:$(".loginArea"),registerArea:$(".registerArea"),loginVerificationCode:$(".loginVerificationCode"),loginVerificationCodeInput:$(".loginVerificationCodeInput"),registerVerificationCodeInput:$("registerVerificationCodeInput"),loginAvatar:$(".avatar"),registerTitle:$(".registerTitle"),loginFormAntiForgeryToken:$(".loginFormAntiForgeryToken"),registerFormAntiForgeryToken:$(".registerFormAntiForgeryToken"),show:function(){this.loginArea.hide();this.registerArea.fadeIn();this.loginVerificationCodeInput.attr("name","");this.loginVerificationCode.attr("id","");loginBtnState.clearData();verificationCode.onDraw(show_num);this.loginAvatar.removeClass("wow zoomInDown");this.loginAvatar.removeAttr("style");this.loginFormAntiForgeryToken.html("");this.registerFormAntiForgeryToken.html(verificationToken)},hide:function(){this.registerArea.hide();this.loginArea.fadeIn();this.loginVerificationCodeInput.attr("name","VerificationCode");this.loginVerificationCode.attr("id","verificationCode");registerBtnState.clearData();this.registerTitle.removeClass("wow flipInX");this.registerTitle.removeAttr("style");this.loginFormAntiForgeryToken.html(verificationToken);this.registerFormAntiForgeryToken.html("")},go:function(){loginBtnState.defaultShow();this.allArea.height(470);reLoginAndRegisterAreaSize();this.show()},backLogin:function(){registerBtnState.defaultShow();this.allArea.height(380);reLoginAndRegisterAreaSize();this.hide()}};layui.use(["form","element"],function(){var n=layui.form,t=layui.element;n.on("submit(loginBtn)",function(n){if(preventFormDefault(),verificationCode.valid()){loginBtnState.statusShow();var t=$("form[name=LoginForm]");return $.ajax({url:"../Account/Login",type:"post",data:n.field,dataType:"json",success:function(n){if(!n.state){if(loginBtnState.defaultShow(),n.goRegister){layer.msg(n.message,{time:0,btn:["立即注册","不了"],yes:function(n){layer.close(n);registerArea.go()}});return}layer.msg("登录失败："+n.message,{icon:5});return}window.location.href=n.reUrl}}),!1}});n.on("submit(registerBtn)",function(n){var t;if(preventFormDefault(),!registerBtnState.agreeTermsOfUse){layer.msg("注册前请阅读并同意使用协议！",{icon:5});return}if(t=n.field,t.Password!==t.ConfirmPassword){layer.msg("两次密码输入不相同！",{icon:5});return}if(verificationCode.valid()){registerBtnState.statusShow();var i=$("form[name=RegisterForm]"),r=i.serialize(),u=JSON.stringify(n.field);return t.Nickname=filterXSS(t.Nickname),t.UserName=filterXSS(t.UserName),$.ajax({url:"../Account/Register",type:"post",data:t,dataType:"json",beforeSend:function(){},success:function(n){if(!n.state){registerBtnState.defaultShow();layer.msg("注册失败："+n.message,{icon:5});return}layer.msg(n.message,{time:0,btn:["立即登录","不了"],yes:function(n){layer.close(n);registerBtnState.clearData();registerArea.backLogin()}});registerBtnState.defaultShow()},error:function(){}}),!1}});n.on("checkbox(termsOfUse)",function(n){layer.open({type:1,title:'<div class="termsOfUseTitle">《云盟服务条款》，用户必读<\/div>',closeBtn:!1,area:"500px;",shade:.8,id:"Tz_termsOfUsePro",btn:["已阅读并同意","不同意"],btnAlign:"c",moveType:1,content:termsOfUseTpl.content,success:function(t){var i=t.find(".layui-layer-btn"),r=i.find(".layui-layer-btn0"),u=i.find(".layui-layer-btn1");r.on("click",function(t){t.preventDefault();n.othis.addClass("layui-form-checked");$(n.elem).attr("checked",!0);registerBtnState.agreeTermsOfUse=!0});u.on("click",function(t){t.preventDefault();n.othis.removeClass("layui-form-checked");$(n.elem).removeAttr("checked");registerBtnState.agreeTermsOfUse=!1})}})})});$("form[name=LoginForm] input[name=Username]").on("change",function(){$.get("../Account/GetLoginAvatar",{username:$(this).val()},function(n){n.path===""?$(".avatar").attr("src","../images/chatAvatars/defaultAvatar.jpg"):$(".avatar").attr("src",n.path)})});$(".randomNickname").on("click",function(n){n.preventDefault();$.get("../Account/RandomNickname",{},function(n){$("input[name=Nickname]").val(n)})});$(".forgetPassword").on("click",function(n){n.preventDefault();layer.msg("别急嘛，人家正在撸代码实现呢~")});loginInit();